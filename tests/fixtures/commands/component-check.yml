- command: 'toolkit:component-check'
  configuration: []
  tokens: ''
  resources:
    - from: sample-composer.lock
      to: composer.lock
  expectations:
    - contains: |
        Checking Mandatory components.
        ==============================

        [Simulator] Running ./vendor/bin/drush status --format=json
        >  Website not installed, using config/sync/core.extension.yml file.
        >  Config file not found at config/sync/core.extension.yml.
        Package dropsolid_purge is mandatory and is not present on the project.
        Package nexteuropa_dashboard_agent is mandatory and is not present on the project.
        Package oe_dashboard_agent is mandatory and is not present on the project.

        Checking Recommended components.
        ================================

        >  This step is in reporting mode, skipping.

        Checking Insecure components.
        =============================

        [Simulator] Running ./vendor/bin/drush pm:security --format=json
        [Simulator] Running composer audit --no-dev --locked --no-scripts --format=json
        >  Insecure components check passed.

        Checking Outdated components.
        =============================

        [Simulator] Running composer outdated --no-dev --locked --direct --minor-only --no-scripts --format=json
        >  Outdated components check passed.

        Checking Abandoned components.
        ==============================

        >  Abandoned components check passed.

        Checking evaluation status components.
        ======================================

        Package drupal/autologout:1.4 does not meet the whitelist version constraint: ^4.5.
        Package drupal/better_exposed_filters:6.0.2 does not meet the whitelist version constraint: ^3.6.
        Package drupal/cas_attributes:2.0.0-beta3 does not meet the whitelist version constraint: ^1.0-rc3.
        The use of drupal/codesnippet:1.8 is restricted. Contact QA Team.
        Package drupal/coffee:1.2 does not meet the whitelist version constraint: ^2.3.
        Package drupal/conditional_fields:4.0.0-alpha1 does not meet the whitelist version constraint: ^3.0-alpha2.
        Package drupal/ctools:4.0.1 does not meet the whitelist version constraint: ^1.15.
        The use of drupal/github_connect:2.0.0-alpha1 is restricted. Contact QA Team.
        Package drupal/purge:3.4 does not meet the whitelist version constraint: ^1.7.
        The use of drupal/queue_ui:3.1.2 is rejected. Contact QA Team.
        The use of drupal/responsive_tables_filter:1.17 is restricted. Contact QA Team.
        The use of drupal/restui:1.21 is rejected. Contact QA Team.
        Package drupal/seckit:2.0.0 does not meet the whitelist version constraint: ^1.11.
        The use of drupal/simple_timeline:1.2 is rejected. Contact QA Team.
        Package drupal/smart_trim:1.3 does not meet the whitelist version constraint: ^1.5.
        Package drupal/views_accordion:2.0.0 does not meet the whitelist version constraint: ^1.6.
        Package drupal/views_bulk_operations:4.2.1 does not meet the whitelist version constraint: ^3.5.
        Package drupal/views_data_export:1.2 does not meet the whitelist version constraint: ^3.2.
        Package drupal/weight:3.3 does not meet the whitelist version constraint: ^2.3.

        Checking dev components.
        ========================

        >  Dev components check passed.

        Checking dev components in require section.
        ===========================================

        >  Dev components in require section check passed

        Checking require section for Drush.
        ===================================

        >  Drush require section check passed.

        Results:
        ========

        --------------------------------- --------
        Mandatory module check            failed
        Recommended module check          passed
        Insecure module check             passed
        Outdated module check             passed
        Abandoned module check            passed
        Dev module check                  passed
        Evaluation module check           failed
        Dev module in require-dev check   passed
        Drush require section check       passed
        --------------------------------- --------

        [ERROR] Failed the components check, please verify the report and update the
        project.

        See the list of packages at

        https://digit-dqa.fpfis.tech.ec.europa.eu/package-reviews.

        ! [NOTE] It is possible to bypass the insecure, outdated and abandoned check:
        !
        !        - Using commit message to skip Insecure and/or Outdated check:
        !
        !           - Include in the message: [SKIP-INSECURE] and/or [SKIP-OUTDATED]
        !
        !
        !
        !        - Using the configuration in the runner.yml.dist as shown below to
        !        skip Outdated or Abandoned:
        !
        !           toolkit:
        !
        !             components:
        !
        !               outdated:
        !
        !                 check: false
        !
        !               abandoned:
        !
        !                 check: false

- command: 'toolkit:component-check'
  configuration:
    toolkit:
      components:
        outdated:
          check: false
        abandoned:
          check: false
  tokens: ''
  resources:
    - from: sample-composer.lock
      to: composer.lock
  expectations:
    - string_contains: Abandoned module check            passed (Skipping)
    - string_contains: Outdated module check             passed (Skipping)

- command: 'toolkit:component-check --test-command'
  configuration:
    toolkit:
      components:
        outdated:
          check: false
  tokens: '[skip_insecure][skip_d9c]'
  resources:
    - from: sample-composer.lock
      to: composer.lock
  expectations:
    - string_contains: Insecure module check             passed (Skipping)
    - string_contains: Outdated module check             passed (Skipping)

- command: 'toolkit:component-check'
  configuration:
    toolkit:
      clean:
        config_file: core.extensions-good.yml
  tokens: ''
  resources:
    - from: sample-core.extensions-good.yml
      to: core.extensions-good.yml
    - from: sample-composer.lock
      to: composer.lock
  expectations:
    - string_contains: Mandatory module check            failed
    - string_contains: Recommended module check          passed
    - string_contains: Insecure module check             passed
    - string_contains: Outdated module check             passed
    - string_contains: Abandoned module check            passed
    - string_contains: Dev module check                  passed
    - string_contains: Evaluation module check           failed
    - string_contains: Dev module in require-dev check   passed
    - string_contains: Drush require section check       passed
