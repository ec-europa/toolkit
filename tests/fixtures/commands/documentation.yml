- command: 'toolkit:generate-documentation'
  resources: []
  expectations:
    - contains: "[ERROR] Fail to download the phpDocumentor.phar file."

- command: 'toolkit:generate-documentation --branch=docs'
  resources:
    - from: sample-bin
      to: vendor/bin/phpDoc
  expectations:
    - contains: |
        [Simulator] Simulating Filesystem\CopyDir(array (
            'docs/guide' => 'docs_tmp/guide',
          ))
          ->exclude(array (
          ))
        [Simulator] Simulating Filesystem\FilesystemStack()
          ->copy('docs/index.rst', 'docs_tmp/index.rst')
        [Simulator] Simulating Filesystem\CleanDir('docs')
        [Simulator] Simulating Filesystem\CopyDir(array (
            'docs_tmp' => 'docs',
          ))
        [Simulator] Simulating Exec('./vendor/bin/phpDoc')
        [Simulator] Running ./vendor/bin/phpDoc
        [Simulator] Simulating Filesystem\CleanDir('docs_tmp')

        [Vcs\GitStack] Running git clone --depth 1 https://github.com/joaocsilva/toolkit docs_tmp --branch docs
        [Simulator] Simulating Filesystem\FilesystemStack()
          ->remove(array (
          ))
        [Simulator] Simulating Filesystem\CopyDir(array (
            'docs' => 'docs_tmp',
          ))
        [Simulator] Simulating ExecStack()
          ->stopOnFail()
          ->exec('git -C docs_tmp config user.name "Toolkit"')
          ->exec('git -C docs_tmp config user.email "DIGIT-NEXTEUROPA-QA@ec.europa.eu"')
          ->exec('git -C docs_tmp add .')
          ->exec('git -C docs_tmp commit -m "Generate documentation."')
          ->exec('git -C docs_tmp push')
        [Simulator] Simulating Filesystem\DeleteDir('docs_tmp')

- command: 'toolkit:generate-documentation --docs-dir=documentation'
  resources:
    - from: sample-bin
      to: vendor/bin/phpDoc
    - mkdir: documentation
    - from: sample-config.yml
      to: documentation/guide/test.html
  expectations:
    - contains: |
        [Simulator] Simulating Filesystem\CopyDir(array (
            'documentation/guide' => 'docs_tmp/guide',
          ))
          ->exclude(array (
            0 => 'documentation/guide/test.html',
          ))
        [Simulator] Simulating Filesystem\FilesystemStack()
          ->copy('documentation/index.rst', 'docs_tmp/index.rst')
        [Simulator] Simulating Filesystem\CleanDir('documentation')
        [Simulator] Simulating Filesystem\CopyDir(array (
            'docs_tmp' => 'documentation',
          ))
        [Simulator] Simulating Exec('./vendor/bin/phpDoc')
        [Simulator] Running ./vendor/bin/phpDoc
        [Simulator] Simulating Filesystem\CleanDir('docs_tmp')

        [Vcs\GitStack] Running git clone --depth 1 https://github.com/joaocsilva/toolkit docs_tmp --branch documentation
        [Simulator] Simulating Filesystem\FilesystemStack()
          ->remove(array (
          ))
        [Simulator] Simulating Filesystem\CopyDir(array (
            'documentation' => 'docs_tmp',
          ))
        [Simulator] Simulating ExecStack()
          ->stopOnFail()
          ->exec('git -C docs_tmp config user.name "Toolkit"')
          ->exec('git -C docs_tmp config user.email "DIGIT-NEXTEUROPA-QA@ec.europa.eu"')
          ->exec('git -C docs_tmp add .')
          ->exec('git -C docs_tmp commit -m "Generate documentation."')
          ->exec('git -C docs_tmp push')
        [Simulator] Simulating Filesystem\DeleteDir('docs_tmp')
